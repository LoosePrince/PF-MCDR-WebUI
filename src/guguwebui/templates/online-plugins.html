<!DOCTYPE html>
<html lang="zh-CN" class="h-full" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true', sidebarOpen: window.innerWidth >= 1024 }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    
    <title>MCDR WebUI - 在线插件</title>
    <!-- 主题预加载脚本 - 防止闪烁 -->
    <script src="js/theme-preload.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js -->
    <script defer src="js/alpine.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Vditor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.9.6/dist/index.css" />
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.9.6/dist/index.min.js"></script>
    <!-- 自定义CSS -->
    <link rel="stylesheet" href="css/main.css">
    <!-- 自定义配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                },
            },
        }
    </script>
    <style>
        /* 自定义CSS变量 */
        :root {
            --sidebar-width: 260px;
            --header-height: 64px;
            --card-bg-light: rgba(255, 255, 255, 0.9);
            --card-bg-dark: rgba(17, 24, 39, 0.8);
        }
        
        /* 卡片悬停效果 */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px) rotate3d(1, 1, 0, 3deg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        
        /* 侧边栏固定宽度 */
        .sidebar-width {
            width: var(--sidebar-width);
        }
        
        /* 主内容区域的左边距，与侧边栏宽度相同 */
        .main-content {
            transition: margin-left 0.3s ease;
        }
        
        .main-content.sidebar-open {
            margin-left: var(--sidebar-width);
        }

        /* 标签样式 */
        .plugin-tag {
            font-size: 0.7rem;
            padding: 0.1rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .plugin-tag.tool {
            background-color: rgba(59, 130, 246, 0.1);
            color: rgb(59, 130, 246);
        }

        .dark .plugin-tag.tool {
            background-color: rgba(59, 130, 246, 0.2);
            color: rgb(96, 165, 250);
        }

        .plugin-tag.game {
            background-color: rgba(16, 185, 129, 0.1);
            color: rgb(16, 185, 129);
        }

        .dark .plugin-tag.game {
            background-color: rgba(16, 185, 129, 0.2);
            color: rgb(52, 211, 153);
        }

        .plugin-tag.api {
            background-color: rgba(245, 158, 11, 0.1);
            color: rgb(245, 158, 11);
        }

        .dark .plugin-tag.api {
            background-color: rgba(245, 158, 11, 0.2);
            color: rgb(252, 211, 77);
        }

        .plugin-tag.information {
            background-color: rgba(147, 51, 234, 0.1);
            color: rgb(147, 51, 234);
        }

        .dark .plugin-tag.information {
            background-color: rgba(147, 51, 234, 0.2);
            color: rgb(237, 233, 254);
        }

        .plugin-tag.management {
            background-color: rgba(147, 51, 234, 0.1);
            color: rgb(147, 51, 234);
        }

        .dark .plugin-tag.management {
            background-color: rgba(147, 51, 234, 0.2);
            color: rgb(237, 233, 254);
        }

        .plugin-tag.test {
            background-color: rgba(239, 68, 68, 0.1);
            color: rgb(239, 68, 68);
        }

        .dark .plugin-tag.test {
            background-color: rgba(239, 68, 68, 0.2);
            color: rgb(252, 165, 165);
        }

        .vditor {
            border: none !important;
        }

        .vditor-toolbar {
            display: none !important;
        }

        .vditor-ir__node img {
            display: inline-block !important;
            vertical-align: middle !important;
            margin: 0 2px !important;
        }
        
        .vditor-ir__node[data-type="a"] {
            display: inline-block !important;
            white-space: nowrap !important;
        }
        
        .vditor-ir__node[data-type="img"] {
            display: inline-block !important;
            white-space: nowrap !important;
        }
        
        .vditor-ir__node[data-type="a"] img {
            display: inline-block !important;
            vertical-align: middle !important;
        }
        
        p {
            white-space: normal !important;
            overflow-wrap: break-word !important;
        }
        
        .vditor-ir__node[data-type="a"] + .vditor-ir__node[data-type="a"] {
            margin-left: 5px !important;
        }
        
        .vditor-ir pre.vditor-reset {
            background-color: transparent !important;
        }
        
        .vditor-ir {
            background-color: transparent !important;
        }
        
        .readme-switch-buttons {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        
        .dark .readme-switch-buttons {
            border-bottom-color: #374151;
        }
        
        .readme-switch-button {
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .readme-switch-button.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .dark .readme-switch-button.active {
            background-color: #2563eb;
        }
        
        .readme-switch-button:not(.active) {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        .dark .readme-switch-button:not(.active) {
            background-color: #374151;
            color: #d1d5db;
        }
        
        .readme-switch-button:not(.active):hover {
            background-color: #e5e7eb;
        }
        
        .dark .readme-switch-button:not(.active):hover {
            background-color: #4b5563;
        }
        
        /* 通知样式 */
        .notification {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border-radius: 0.375rem;
            color: white;
            font-weight: 500;
            z-index: 100;
            max-width: 24rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            font-size: 1rem;
            transform: scale(1.05);
            animation: notification-pulse 2s infinite;
        }

        @keyframes notification-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(66, 153, 225, 0.5);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(66, 153, 225, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(66, 153, 225, 0);
            }
        }

        /* 插件详情模态窗口样式 */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            max-width: 90%;
            width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .dark .modal-content {
            background-color: #1f2937;
            border: 1px solid #374151;
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark .modal-header {
            border-bottom-color: #374151;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(90vh - 130px);
        }

        .modal-footer {
            padding: 0 1.5rem;
            height: 58px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            align-items: center;
        }

        .dark .modal-footer {
            border-top-color: #374151;
        }

        /* 依赖项列表样式 */
        .dependencies-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .dependency-item {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .dark .dependency-item {
            background-color: #374151;
            color: #d1d5db;
        }

        /* 分页控件样式 */
        .pagination-control {
            width: 2.5rem;
            height: 2.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .pagination-control.active {
            background-color: #3b82f6;
            color: white;
        }

        .dark .pagination-control.active {
            background-color: #2563eb;
        }

        .pagination-control:not(.active):hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .dark .pagination-control:not(.active):hover {
            background-color: #374151;
            color: #f9fafb;
        }

        .pagination-control.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div x-data="onlinePluginsData" x-init="init()">
        <!-- 侧边栏 -->
        {% include "sideNavigator.html" %}

        <!-- 主内容区 -->
        <div id="main-content" :class="{'sidebar-open': sidebarOpen}" class="main-content min-h-screen transition-all duration-300">
            <!-- 顶部导航栏 -->
            <header id="header" class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 h-16 fixed top-0 right-0 left-0 z-20" :class="{'left-0': !sidebarOpen, 'left-[260px]': sidebarOpen}">
                <div class="h-full px-4 sm:px-6 flex items-center justify-between">
                    <!-- 左侧部分 -->
                    <div class="flex items-center">
                        <!-- 移动端菜单按钮 -->
                        <button @click="sidebarOpen = !sidebarOpen" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none transition-colors">
                            <i :class="sidebarOpen ? 'fa-times' : 'fa-bars'" class="fas"></i>
                        </button>
                        
                        <!-- 页面标题 -->
                        <h1 class="ml-4 text-xl font-semibold text-gray-800 dark:text-white">在线插件</h1>
                    </div>
                    
                    <!-- 右侧部分 -->
                    <div class="flex items-center space-x-4">
                        <!-- 公告 -->
                        <div class="nav-notice hidden md:flex items-center bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-1 rounded-full text-xs font-medium mr-2">
                            <span class="nav-notice-text"><i class="fas fa-circle-notch fa-spin mr-1.5"></i> 加载公告中...</span>
                        </div>
                    
                        <!-- 服务器状态 -->
                        <div class="hidden sm:flex items-center">
                            <div class="px-3 py-1 rounded-full text-xs font-medium flex items-center" :class="{
                                'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300': serverStatus === 'online',
                                'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300': serverStatus === 'offline',
                                'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300': serverStatus === 'error',
                                'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300': serverStatus === 'loading'
                            }">
                                <span x-show="serverStatus === 'online'" class="flex items-center">
                                    <i class="fas fa-circle mr-1 text-xs"></i>
                                    <span>在线</span>
                                </span>
                                <span x-show="serverStatus === 'offline'" class="flex items-center">
                                    <i class="fas fa-circle mr-1 text-xs"></i>
                                    <span>离线</span>
                                </span>
                                <span x-show="serverStatus === 'error'" class="flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    <span>错误</span>
                                </span>
                                <span x-show="serverStatus === 'loading'" class="flex items-center">
                                    <i class="fas fa-circle-notch fa-spin mr-1 text-xs"></i>
                                    <span>加载中</span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- 主题切换 -->
                        <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none transition-colors">
                            <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                        </button>
                        
                        <!-- 用户信息 -->
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white user-avatar overflow-hidden">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300 js-username" x-text="userName || '用户'"></span>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- 主内容 -->
            <main class="pt-24 px-4 sm:px-6 md:px-8 pb-8">
                <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg p-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white">在线插件仓库</h2>
                        
                        <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                            <!-- 排序控件 -->
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-600 dark:text-gray-300">排序:</span>
                                <button 
                                    @click="toggleSortMethod('name')" 
                                    class="inline-flex items-center px-2 py-1 text-xs rounded border"
                                    :class="sortMethod === 'name' ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800' : 'border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300'"
                                >
                                    <span>按名称</span>
                                    <template x-if="sortMethod === 'name'">
                                        <i class="ml-1 fas" :class="sortDirection === 'asc' ? 'fa-sort-alpha-down' : 'fa-sort-alpha-up'"></i>
                                    </template>
                                </button>
                                <button 
                                    @click="toggleSortMethod('time')" 
                                    class="inline-flex items-center px-2 py-1 text-xs rounded border"
                                    :class="sortMethod === 'time' ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800' : 'border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300'"
                                >
                                    <span>按时间</span>
                                    <template x-if="sortMethod === 'time'">
                                        <i class="ml-1 fas" :class="sortDirection === 'asc' ? 'fa-sort-numeric-down' : 'fa-sort-numeric-up'"></i>
                                    </template>
                                </button>
                                <button 
                                    @click="toggleSortMethod('downloads')" 
                                    class="inline-flex items-center px-2 py-1 text-xs rounded border"
                                    :class="sortMethod === 'downloads' ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800' : 'border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300'"
                                >
                                    <span>按下载量</span>
                                    <template x-if="sortMethod === 'downloads'">
                                        <i class="ml-1 fas" :class="sortDirection === 'asc' ? 'fa-sort-numeric-down' : 'fa-sort-numeric-up'"></i>
                                    </template>
                                </button>
                            </div>
                        
                            <!-- 搜索栏 -->
                            <div class="relative flex-1">
                                <input 
                                    type="text" 
                                    class="w-full pl-10 pr-4 py-2 rounded-lg border dark:border-gray-700 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"
                                    placeholder="搜索插件..."
                                    x-model="searchQuery"
                                >
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                <button 
                                    x-show="searchQuery" 
                                    @click="searchQuery = ''"
                                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- 仓库选择按钮 - 悬停菜单 -->
                            <div class="relative" x-data="{ repoMenuOpen: false, tempRepoUrl: '' }">
                                <button 
                                    @click="repoMenuOpen = !repoMenuOpen"
                                    @mouseenter="repoMenuOpen = true"
                                    class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                >
                                    <i class="fas fa-server mr-2"></i>
                                    <span x-text="selectedRepository ? selectedRepository.name : '选择仓库'"></span>
                                    <i class="fas fa-chevron-down ml-2"></i>
                                </button>
                                
                                <!-- 仓库选择悬停菜单 -->
                                <div 
                                    x-show="repoMenuOpen"
                                    @mouseleave="repoMenuOpen = false"
                                    class="absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 z-50"
                                    x-transition:enter="transition ease-out duration-100"
                                    x-transition:enter-start="transform opacity-0 scale-95"
                                    x-transition:enter-end="transform opacity-100 scale-100"
                                    x-transition:leave="transition ease-in duration-75"
                                    x-transition:leave-start="transform opacity-100 scale-100"
                                    x-transition:leave-end="transform opacity-0 scale-95"
                                >
                                    <!-- 临时访问指定仓库 -->
                                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                                        <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">临时访问仓库</div>
                                        <div class="flex items-center">
                                            <input 
                                                type="text" 
                                                x-model="tempRepoUrl"
                                                placeholder="输入仓库URL..."
                                                class="w-full text-sm px-2 py-1.5 rounded border dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"
                                            >
                                            <button 
                                                @click="switchRepository({name: '临时仓库', url: tempRepoUrl}); repoMenuOpen = false;"
                                                class="ml-2 p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700"
                                                :disabled="!tempRepoUrl"
                                            >
                                                <i class="fas fa-arrow-right text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- 可用仓库列表 -->
                                    <div class="max-h-60 overflow-y-auto py-1">
                                        <div class="text-xs font-medium text-gray-500 dark:text-gray-400 px-4 py-1">选择仓库</div>
                                        <template x-for="repo in repositories" :key="repo.url">
                                            <a 
                                                href="javascript:void(0)" 
                                                @click="switchRepository(repo); repoMenuOpen = false;"
                                                class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2"
                                                :class="{'bg-blue-50 dark:bg-blue-900/20': selectedRepository && selectedRepository.url === repo.url}"
                                            >
                                                <i class="fas fa-check text-blue-500" x-show="selectedRepository && selectedRepository.url === repo.url"></i>
                                                <i class="fas fa-server text-gray-400" x-show="!selectedRepository || selectedRepository.url !== repo.url"></i>
                                                <span x-text="repo.name"></span>
                                            </a>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- 刷新按钮 -->
                            <button 
                                @click="loadPlugins" 
                                class="inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                                :disabled="loading"
                            >
                                <template x-if="!loading">
                                    <i class="fas fa-sync-alt mr-2"></i>
                                </template>
                                <template x-if="loading">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>
                                </template>
                                <span x-text="loading ? '加载中...' : '刷新插件列表'"></span>
                            </button>
                        </div>
                    </div>

                    <!-- 加载状态 -->
                    <div x-show="loading" class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                        <span class="ml-3 text-gray-600 dark:text-gray-400">加载插件中...</span>
                    </div>

                    <!-- 插件列表 -->
                    <div x-show="!loading && getPaginatedPlugins().length === 0" class="text-center py-12">
                        <i class="fas fa-puzzle-piece text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">未找到符合条件的插件</p>
                    </div>

                    <div x-show="!loading && getPaginatedPlugins().length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <template x-for="plugin in getPaginatedPlugins()" :key="plugin.id">
                            <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow">
                                <div class="p-5">
                                    <div class="flex flex-col md:flex-row md:items-center justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-start">
                                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="plugin.name || plugin.id"></h3>
                                                <span class="ml-2 text-sm text-gray-500 dark:text-gray-400" x-text="'v' + (plugin.latest_version || '未知')"></span>
                                            </div>
                                            <p class="text-sm text-gray-500 dark:text-gray-400" x-text="'ID: ' + plugin.id"></p>
                                        </div>
                                        
                                        <div class="flex flex-wrap mt-2 md:mt-0 gap-2">
                                            <template x-for="label in plugin.labels || []" :key="label">
                                                <span class="plugin-tag" :class="label && typeof label === 'string' ? label.toLowerCase() : ''" x-text="label"></span>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <p class="text-sm text-gray-600 dark:text-gray-300" x-text="getPluginDescription(plugin)"></p>
                                    </div>
                                    
                                    <div class="mt-3 text-xs text-gray-500 dark:text-gray-400 flex items-center flex-wrap gap-2">
                                        <span>
                                            <i class="fas fa-user mr-1"></i>
                                            <template x-for="(author, index) in plugin.authors || []" :key="index">
                                                <span>
                                                    <template x-if="index > 0">
                                                        <span>, </span>
                                                    </template>
                                                    <template x-if="author.link">
                                                        <a :href="author.link" target="_blank" class="text-blue-500 hover:underline" x-text="author.name"></a>
                                                    </template>
                                                    <template x-if="!author.link">
                                                        <span x-text="author.name"></span>
                                                    </template>
                                                </span>
                                            </template>
                                        </span>
                                        
                                        <span x-show="plugin.last_update_time">
                                            <i class="fas fa-calendar-alt mr-1"></i>
                                            <span x-text="formatDate(plugin.last_update_time)"></span>
                                        </span>
                                        
                                        <!-- 显示协议类型 -->
                                        <span x-show="plugin.license">
                                            <i class="fas fa-file-contract mr-1"></i>
                                            <template x-if="plugin.license_url">
                                                <a href="javascript:void(0)" @click="showLicenseDetails(null, plugin.license_url)" class="text-blue-500 hover:underline" x-text="plugin.license"></a>
                                            </template>
                                            <template x-if="!plugin.license_url">
                                                <a href="javascript:void(0)" @click="showLicenseDetails(plugin.license.toLowerCase().replace(/(-|\.)/g, ''), null)" class="text-blue-500 hover:underline" x-text="plugin.license"></a>
                                            </template>
                                        </span>
                                        
                                        <!-- 显示下载量 -->
                                        <span x-show="plugin.downloads">
                                            <i class="fas fa-download mr-1"></i>
                                            <span x-text="formatNumber(plugin.downloads)"></span>
                                        </span>
                                    </div>
                                    
                                    <div class="mt-4 flex flex-wrap justify-end gap-2">
                                        <button 
                                            @click="showPluginDetails(plugin)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                        >
                                            <i class="fas fa-info-circle mr-1.5"></i>
                                            <span>详情</span>
                                        </button>
                                        
                                        <!-- 查看说明文档按钮 -->
                                        <button 
                                            x-show="plugin.readme_url"
                                            @click="showReadme(plugin)"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                        >
                                            <i class="fas fa-book mr-1.5"></i>
                                            <span>说明文档</span>
                                        </button>
                                        
                                        <!-- 查看仓库页按钮 - 仅在官方仓库(repoId为0)显示 -->
                                        <button 
                                            x-show="selectedRepository && selectedRepository.repoId === 0"
                                            @click="showRepositoryPage(plugin.id)" 
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                        >
                                            <i class="fas fa-external-link-alt mr-1.5"></i>
                                            <span>查看仓库页</span>
                                        </button>
                                        
                                        <a 
                                            x-show="plugin.repository_url"
                                            :href="plugin.repository_url" 
                                            target="_blank"
                                            class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                        >
                                            <i class="fab fa-github mr-1.5"></i>
                                            <span>GitHub</span>
                                        </a>
                                        
                                        <!-- 显示已安装标签 -->
                                        <div
                                            x-show="isPluginUpToDate(plugin.id, plugin.latest_version)"
                                            class="inline-flex items-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-green-600"
                                        >
                                            <i class="fas fa-check-circle mr-1.5"></i>
                                            <span x-text="'已安装 v' + getInstalledPluginVersion(plugin.id)"></span>
                                        </div>
                                        
                                        <!-- 安装/更新按钮 -->
                                        <button 
                                            x-show="!isPluginUpToDate(plugin.id, plugin.latest_version)"
                                            @click="installPlugin(plugin.id)"
                                            class="inline-flex items-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none transition-colors"
                                            :disabled="processingPlugins[plugin.id]"
                                        >
                                            <template x-if="!processingPlugins[plugin.id]">
                                                <i class="fas fa-download mr-1.5"></i>
                                            </template>
                                            <template x-if="processingPlugins[plugin.id]">
                                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                            </template>
                                            <span x-text="isPluginInstalled(plugin.id) ? '更新' : '安装'"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- 分页控件 -->
                    <div x-show="!loading && plugins && plugins.length > 0 && getTotalPages() > 1" class="mt-6 flex justify-center">
                        <div class="flex items-center space-x-2">
                            <button 
                                @click="goToPage(currentPage - 1)" 
                                :disabled="currentPage === 1"
                                class="pagination-control" 
                                :class="{ 'disabled': currentPage === 1 }"
                            >
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <template x-for="(page, index) in getPageNumbers()" :key="index">
                                <div>
                                    <template x-if="page === '...'">
                                        <span class="px-2 py-1">...</span>
                                    </template>
                                    <template x-if="page !== '...'">
                                        <button 
                                            @click="goToPage(page)" 
                                            class="pagination-control" 
                                            :class="{ 'active': currentPage === page }"
                                            x-text="page"
                                        ></button>
                                    </template>
                                </div>
                            </template>
                            
                            <button 
                                @click="goToPage(currentPage + 1)" 
                                :disabled="currentPage === getTotalPages()"
                                class="pagination-control" 
                                :class="{ 'disabled': currentPage === getTotalPages() }"
                            >
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 通知 -->
                <div 
                    x-show="showNotification" 
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-90"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-90"
                    class="notification"
                    :class="{
                        'bg-green-500': notificationType === 'success',
                        'bg-red-500': notificationType === 'error',
                        'bg-blue-500': notificationType === 'info'
                    }"
                >
                    <template x-if="notificationType === 'success'">
                        <i class="fas fa-check-circle mr-2"></i>
                    </template>
                    <template x-if="notificationType === 'error'">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                    </template>
                    <template x-if="notificationType === 'info'">
                        <i class="fas fa-info-circle mr-2"></i>
                    </template>
                    <span x-text="notificationMessage"></span>
                </div>
                
                <!-- 插件安装进度模态窗口 -->
                <div x-show="showInstallModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" @click.away="closeInstallModal()">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="'安装进度 - ' + installPluginId"></h3>
                            <button @click="closeInstallModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <!-- 进度条 -->
                            <div class="mb-4">
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="installMessage"></span>
                                    <span id="install-progress-text" class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="Math.round(installProgress) + '%'"></span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                    <div id="install-progress-bar" class="bg-blue-600 h-2.5 rounded-full" :style="'width: ' + installProgress + '%'"></div>
                                </div>
                            </div>
                            
                            <!-- 安装状态指示器 -->
                            <div class="flex items-center mb-4">
                                <div class="px-3 py-1 rounded-full text-xs font-medium flex items-center" :class="{
                                    'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300': installStatus === 'running',
                                    'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300': installStatus === 'completed',
                                    'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300': installStatus === 'failed',
                                    'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300': installStatus === 'pending'
                                }">
                                    <span x-show="installStatus === 'running'" class="flex items-center">
                                        <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                        <span>正在处理</span>
                                    </span>
                                    <span x-show="installStatus === 'completed'" class="flex items-center">
                                        <i class="fas fa-check-circle mr-1.5"></i>
                                        <span>已完成</span>
                                    </span>
                                    <span x-show="installStatus === 'failed'" class="flex items-center">
                                        <i class="fas fa-exclamation-circle mr-1.5"></i>
                                        <span>失败</span>
                                    </span>
                                    <span x-show="installStatus === 'pending'" class="flex items-center">
                                        <i class="fas fa-hourglass-start mr-1.5"></i>
                                        <span>等待中</span>
                                    </span>
                                </div>
                            </div>
                            
                            <!-- 安装日志 -->
                            <div class="mt-4">
                                <h4 class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">安装日志</h4>
                                <div class="bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md p-3 h-56 overflow-y-auto font-mono text-xs">
                                    <template x-for="(message, index) in installLogMessages" :key="index">
                                        <div class="py-0.5" :class="{'text-red-500': message.includes('错误') || message.includes('失败') || message.includes('⚠'), 'text-green-500': message.includes('成功') || message.includes('✓')}">
                                            <span x-text="message"></span>
                                        </div>
                                    </template>
                                    <div x-show="installLogMessages.length === 0" class="text-gray-500 dark:text-gray-400">
                                        等待日志...
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button @click="closeInstallModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                                <span x-text="installStatus === 'running' ? '隐藏' : '关闭'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 插件详情模态窗口 -->
                <div x-show="showPluginModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" @click.away="closePluginModal()">
                        <div class="modal-header">
                            <div class="flex items-center">
                                <!-- 返回按钮 -->
                                <button 
                                    x-show="pluginHistory.length > 0" 
                                    @click="goBackToPlugin()" 
                                    class="mr-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                                    title="返回上一个插件"
                                >
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="currentPlugin ? currentPlugin.name || currentPlugin.id : '插件详情'"></h3>
                                
                                <!-- 导航路径显示 -->
                                <div x-show="pluginHistory.length > 0" class="ml-3 text-sm text-gray-500">
                                    <span>访问历史: </span>
                                    <template x-for="(historyPlugin, index) in pluginHistory.slice().reverse().slice(0, 2)" :key="index">
                                        <span>
                                            <span x-text="historyPlugin.name || historyPlugin.id"></span>
                                            <i class="fas fa-chevron-right mx-1" x-show="index < Math.min(pluginHistory.length - 1, 1)"></i>
                                        </span>
                                    </template>
                                    <i class="fas fa-chevron-right mx-1" x-show="pluginHistory.length > 2"></i>
                                </div>
                            </div>
                            <button @click="closePluginModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body" x-show="currentPlugin">
                            <div class="space-y-4">
                                <!-- 基本信息 -->
                                <div>
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-2">基本信息</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">ID:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="currentPlugin?.id"></p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">最新版本:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="currentPlugin?.latest_version || '未知'"></p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">最后更新:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="formatDate(currentPlugin?.last_update_time) || '未知'"></p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">作者:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200">
                                                <template x-for="(author, index) in currentPlugin?.authors || []" :key="index">
                                                    <span>
                                                        <template x-if="index > 0">
                                                            <span>, </span>
                                                        </template>
                                                        <template x-if="author.link">
                                                            <a :href="author.link" target="_blank" class="text-blue-500 hover:underline" x-text="author.name"></a>
                                                        </template>
                                                        <template x-if="!author.link">
                                                            <span x-text="author.name"></span>
                                                        </template>
                                                    </span>
                                                </template>
                                            </p>
                                        </div>
                                        <!-- 协议信息 -->
                                        <div x-show="currentPlugin && currentPlugin.license">
                                            <p class="text-sm text-gray-500 dark:text-gray-400">协议:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200">
                                                <template x-if="currentPlugin && currentPlugin.license_url">
                                                    <a href="javascript:void(0)" @click="showLicenseDetails(null, currentPlugin.license_url)" class="text-blue-500 hover:underline" x-text="currentPlugin && currentPlugin.license ? currentPlugin.license : '未知'"></a>
                                                </template>
                                                <template x-if="currentPlugin && currentPlugin.license && !currentPlugin.license_url">
                                                    <a href="javascript:void(0)" @click="showLicenseDetails(currentPlugin.license.toLowerCase().replace(/(-|\.)/g, ''), null)" class="text-blue-500 hover:underline" x-text="currentPlugin.license"></a>
                                                </template>
                                            </p>
                                        </div>
                                        <!-- 下载量信息 -->
                                        <div x-show="currentPlugin?.downloads">
                                            <p class="text-sm text-gray-500 dark:text-gray-400">下载量:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="formatNumber(currentPlugin?.downloads || 0)"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 描述 -->
                                <div x-show="currentPlugin?.description">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-2">描述</h4>
                                    <div class="space-y-2">
                                        <div x-show="currentPlugin?.description?.zh_cn">
                                            <p class="text-sm text-gray-500 dark:text-gray-400">中文:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="currentPlugin?.description?.zh_cn"></p>
                                        </div>
                                        <div x-show="currentPlugin?.description?.en_us">
                                            <p class="text-sm text-gray-500 dark:text-gray-400">英文:</p>
                                            <p class="text-sm text-gray-800 dark:text-gray-200" x-text="currentPlugin?.description?.en_us"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 标签 -->
                                <div x-show="currentPlugin?.labels && currentPlugin.labels.length">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-2">标签</h4>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="label in currentPlugin?.labels || []" :key="label">
                                            <span class="plugin-tag" :class="label.toLowerCase()" x-text="label"></span>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- 依赖项 -->
                                <div x-show="currentPlugin?.dependencies && Object.keys(currentPlugin.dependencies).length">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-2">依赖项</h4>
                                    <div class="dependencies-list">
                                        <template x-for="(version, name) in currentPlugin?.dependencies || {}" :key="name">
                                            <div class="dependency-item flex items-center flex-nowrap">
                                                <!-- 排除mcdreforged，使其他依赖可点击 -->
                                                <template x-if="name.toLowerCase() === 'mcdreforged'">
                                                    <span x-text="name"></span>
                                                </template>
                                                <template x-if="name.toLowerCase() !== 'mcdreforged'">
                                                    <span 
                                                        @click="showDependencyDetails(name)" 
                                                        class="cursor-pointer hover:text-blue-500 hover:underline inline-flex items-center" 
                                                        :title="'点击查看 ' + name + ' 的详细信息'"
                                                    >
                                                        <span x-text="name"></span>
                                                        <i class="fas fa-external-link-alt ml-1 text-xs text-blue-500"></i>
                                                    </span>
                                                </template>
                                                <span class="text-gray-500 dark:text-gray-400 whitespace-nowrap" x-text="': ' + version"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- 链接 -->
                                <div>
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-2">链接</h4>
                                    <div class="space-y-2">
                                        <div x-show="currentPlugin?.id">
                                            <a 
                                                :href="'https://mcdreforged.com/zh-CN/plugin/' + (currentPlugin?.id || '')" 
                                                target="_blank"
                                                class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:underline"
                                            >
                                                <i class="fas fa-external-link-alt mr-1.5"></i>
                                                <span>MCDR 插件索引</span>
                                            </a>
                                        </div>
                                        <div x-show="currentPlugin?.repository_url">
                                            <a 
                                                :href="currentPlugin?.repository_url" 
                                                target="_blank"
                                                class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:underline"
                                            >
                                                <i class="fab fa-github mr-1.5"></i>
                                                <span>GitHub 仓库</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button @click="closePluginModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                                <span>关闭</span>
                            </button>
                            
                            <!-- 已安装标签 -->
                            <div
                                x-show="currentPlugin && isPluginUpToDate(currentPlugin.id, currentPlugin.latest_version)"
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600"
                            >
                                <i class="fas fa-check-circle mr-1.5"></i>
                                <span x-text="'已安装 v' + getInstalledPluginVersion(currentPlugin?.id)"></span>
                            </div>
                            
                            <!-- 安装/更新按钮 -->
                            <button 
                                x-show="currentPlugin && !isPluginUpToDate(currentPlugin.id, currentPlugin.latest_version)"
                                @click="installPlugin(currentPlugin?.id); closePluginModal()"
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none"
                                :disabled="currentPlugin && processingPlugins[currentPlugin.id]"
                            >
                                <template x-if="!currentPlugin || !processingPlugins[currentPlugin?.id]">
                                    <i class="fas fa-download mr-1.5"></i>
                                </template>
                                <template x-if="currentPlugin && processingPlugins[currentPlugin?.id]">
                                    <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                </template>
                                <span x-text="currentPlugin && isPluginInstalled(currentPlugin.id) ? '更新' : '安装'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 仓库页面模态窗口 -->
                <div x-show="showRepoModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" style="width: 90%; height: 90%; max-height: 90vh; max-width: 1200px;">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">插件仓库页面</h3>
                            <div class="flex items-center space-x-2">
                                <a 
                                    :href="currentRepoUrl" 
                                    target="_blank"
                                    class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"
                                    title="在新标签页中打开"
                                >
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                                <button 
                                    @click="closeRepoModal()" 
                                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="w-full h-full bg-white dark:bg-gray-800 overflow-hidden" style="height: calc(90vh - 120px);">
                            <iframe 
                                :src="currentRepoUrl" 
                                class="w-full h-full border-0" 
                                sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
                                loading="lazy"
                            ></iframe>
                        </div>
                        
                        <div class="modal-footer">
                            <button 
                                @click="closeRepoModal()" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                <span>关闭</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- README模态窗口 -->
                <div x-show="showReadmeModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" style="width: 90%; height: 90%; max-height: 90vh; max-width: 1200px;">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="'说明文档 - ' + (currentReadmePlugin ? currentReadmePlugin.name : '')"></h3>
                            <div class="flex items-center space-x-2">
                                <a 
                                    x-show="currentReadmePlugin && currentReadmePlugin.readme_url"
                                    :href="currentReadmePlugin ? currentReadmePlugin.readme_url : ''" 
                                    target="_blank"
                                    class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"
                                    title="在新标签页中打开"
                                >
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                                <button 
                                    @click="closeReadmeModal()" 
                                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="w-full h-full bg-white dark:bg-gray-800 overflow-hidden" style="height: calc(90vh - 120px);">
                            <!-- 文档切换按钮组 -->
                            <div class="flex justify-center mt-4 relative">
                                <div class="inline-flex rounded-lg p-1 bg-gray-100 dark:bg-gray-700 relative">
                                    <!-- 滑动背景 -->
                                    <div
                                        class="absolute inset-y-1 transition-all duration-200 ease-out rounded-md bg-white dark:bg-gray-600 shadow-sm"
                                        :style="{ 
                                            left: readmeType === 'catalogue' ? '4px' : '50%', 
                                            right: readmeType === 'catalogue' ? '50%' : '4px'
                                        }"
                                    ></div>
                                    
                                    <!-- 介绍按钮 -->
                                    <button 
                                        @click="switchReadmeType('catalogue')" 
                                        class="relative px-6 py-2 text-sm font-medium transition-colors duration-200"
                                        :class="{
                                            'text-gray-900 dark:text-white': readmeType === 'catalogue',
                                            'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200': readmeType !== 'catalogue',
                                            'opacity-50 cursor-not-allowed': !catalogueUrl
                                        }"
                                        :disabled="!catalogueUrl"
                                    >
                                        <div class="flex items-center space-x-1">
                                            <i class="fas fa-book-open text-xs"></i>
                                            <span>仓库介绍</span>
                                            <!-- 加载指示器 -->
                                            <i 
                                                x-show="readmeLoading && readmeType === 'catalogue'"
                                                class="fas fa-circle-notch fa-spin ml-1 text-xs"
                                            ></i>
                                        </div>
                                    </button>
                                    
                                    <!-- 自述文件按钮 -->
                                    <button 
                                        @click="switchReadmeType('readme')" 
                                        class="relative px-6 py-2 text-sm font-medium transition-colors duration-200"
                                        :class="{
                                            'text-gray-900 dark:text-white': readmeType === 'readme',
                                            'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200': readmeType !== 'readme'
                                        }"
                                    >
                                        <div class="flex items-center space-x-1">
                                            <i class="fas fa-file-alt text-xs"></i>
                                            <span>自述文件</span>
                                            <!-- 加载指示器 -->
                                            <i 
                                                x-show="readmeLoading && readmeType === 'readme'"
                                                class="fas fa-circle-notch fa-spin ml-1 text-xs"
                                            ></i>
                                        </div>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 加载状态 -->
                            <div 
                                x-show="readmeLoading" 
                                x-transition:enter="transition-opacity duration-300"
                                x-transition:enter-start="opacity-0"
                                x-transition:enter-end="opacity-100"
                                x-transition:leave="transition-opacity duration-300"
                                x-transition:leave-start="opacity-100"
                                x-transition:leave-end="opacity-0"
                                class="flex flex-col justify-center items-center h-full"
                            >
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                                <span class="mt-4 text-gray-600 dark:text-gray-400" x-text="readmeType === 'catalogue' ? '加载介绍文档中...' : '加载自述文件中...'"></span>
                            </div>
                            
                            <!-- 错误提示 -->
                            <div 
                                x-show="readmeError" 
                                x-transition:enter="transition-opacity duration-300"
                                x-transition:enter-start="opacity-0"
                                x-transition:enter-end="opacity-100"
                                x-transition:leave="transition-opacity duration-300"
                                x-transition:leave-start="opacity-100"
                                x-transition:leave-end="opacity-0"
                                class="flex flex-col justify-center items-center h-full p-8 text-center"
                            >
                                <i class="fas fa-exclamation-circle text-4xl text-red-500 mb-4"></i>
                                <p class="text-gray-700 dark:text-gray-300 mb-2" x-text="readmeErrorMessage"></p>
                                <button 
                                    @click="retryLoadReadme()" 
                                    class="mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none transition-colors duration-200"
                                >
                                    <i class="fas fa-redo mr-2"></i>
                                    <span>重试</span>
                                </button>
                            </div>
                            
                            <!-- README内容 -->
                            <div 
                                x-show="!readmeLoading && !readmeError" 
                                x-transition:enter="transition-opacity duration-300"
                                x-transition:enter-start="opacity-0"
                                x-transition:enter-end="opacity-100"
                                x-transition:leave="transition-opacity duration-300"
                                x-transition:leave-start="opacity-100"
                                x-transition:leave-end="opacity-0"
                                id="vditor" 
                                class="h-full overflow-auto p-4"
                            ></div>
                        </div>
                        
                        <div class="modal-footer">
                            <button 
                                @click="closeReadmeModal()" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                <span>关闭</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 协议详情模态窗口 -->
                <div x-show="showLicenseModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" style="max-width: 800px;" @click.away="closeLicenseModal()">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                <span x-text="currentLicense ? (currentLicense.name || '协议详情') : '协议详情'"></span>
                                <template x-if="currentLicense && currentLicense.spdx_id">
                                    <span class="ml-2 text-sm text-gray-600 dark:text-gray-400" x-text="currentLicense.spdx_id"></span>
                                </template>
                            </h3>
                            <button @click="closeLicenseModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <!-- 加载状态 -->
                            <div x-show="licenseFetching" class="py-10 flex justify-center items-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                                <span class="ml-3 text-gray-600 dark:text-gray-400">加载协议信息中...</span>
                            </div>
                            
                            <!-- 错误状态 -->
                            <div x-show="licenseError" class="py-8 text-center">
                                <i class="fas fa-exclamation-circle text-4xl text-red-500 mb-4"></i>
                                <p class="text-gray-700 dark:text-gray-300">获取协议信息失败，请稍后再试</p>
                            </div>
                            
                            <!-- 协议信息 -->
                            <div x-show="currentLicense && !licenseFetching && !licenseError" class="space-y-6">
                                <!-- 简介 -->
                                <div x-show="currentLicense && currentLicense.description" class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                                    <p class="text-gray-700 dark:text-gray-300" x-text="currentLicense && currentLicense.description ? currentLicense.description : ''"></p>
                                </div>
                                
                                <!-- 使用方法 -->
                                <div x-show="currentLicense && currentLicense.implementation" class="space-y-2">
                                    <h4 class="font-medium text-gray-900 dark:text-white">实施方法</h4>
                                    <p class="text-gray-700 dark:text-gray-300" x-text="currentLicense && currentLicense.implementation ? currentLicense.implementation : ''"></p>
                                </div>
                                
                                <!-- 权限、条件和限制 -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <!-- 权限 -->
                                    <div x-show="currentLicense && currentLicense.permissions && currentLicense.permissions.length" class="space-y-2">
                                        <h4 class="font-medium text-gray-900 dark:text-white flex items-center">
                                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                            <span>权限</span>
                                        </h4>
                                        <ul class="space-y-1 pl-5 list-disc">
                                            <template x-for="permission in currentLicense && currentLicense.permissions ? currentLicense.permissions : []" :key="permission">
                                                <li class="text-gray-700 dark:text-gray-300" x-text="permission ? permission.replace(/-/g, ' ') : ''"></li>
                                            </template>
                                        </ul>
                                    </div>
                                    
                                    <!-- 条件 -->
                                    <div x-show="currentLicense && currentLicense.conditions && currentLicense.conditions.length" class="space-y-2">
                                        <h4 class="font-medium text-gray-900 dark:text-white flex items-center">
                                            <i class="fas fa-exclamation-circle text-blue-500 mr-2"></i>
                                            <span>条件</span>
                                        </h4>
                                        <ul class="space-y-1 pl-5 list-disc">
                                            <template x-for="condition in currentLicense && currentLicense.conditions ? currentLicense.conditions : []" :key="condition">
                                                <li class="text-gray-700 dark:text-gray-300" x-text="condition ? condition.replace(/-/g, ' ') : ''"></li>
                                            </template>
                                        </ul>
                                    </div>
                                    
                                    <!-- 限制 -->
                                    <div x-show="currentLicense && currentLicense.limitations && currentLicense.limitations.length" class="space-y-2">
                                        <h4 class="font-medium text-gray-900 dark:text-white flex items-center">
                                            <i class="fas fa-ban text-red-500 mr-2"></i>
                                            <span>限制</span>
                                        </h4>
                                        <ul class="space-y-1 pl-5 list-disc">
                                            <template x-for="limitation in currentLicense && currentLicense.limitations ? currentLicense.limitations : []" :key="limitation">
                                                <li class="text-gray-700 dark:text-gray-300" x-text="limitation ? limitation.replace(/-/g, ' ') : ''"></li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- 协议正文 -->
                                <div x-show="currentLicense && currentLicense.body">
                                    <h4 class="font-medium text-gray-900 dark:text-white">协议正文</h4>
                                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 overflow-auto max-h-96">
                                        <pre class="text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap font-mono" x-text="currentLicense && currentLicense.body ? currentLicense.body : ''"></pre>
                                    </div>
                                </div>
                                
                                <!-- 链接 -->
                                <div x-show="currentLicense && currentLicense.html_url">
                                    <a :href="currentLicense && currentLicense.html_url ? currentLicense.html_url : '#'" target="_blank" class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:underline">
                                        <i class="fas fa-external-link-alt mr-1.5"></i>
                                        <span>查看完整协议页面</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button 
                                @click="closeLicenseModal()" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none"
                            >
                                <span>关闭</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 安装确认模态窗口 -->
                <div x-show="showInstallConfirmModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content max-w-md" @click.away="closeInstallConfirm()">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">安装插件确认</h3>
                            <button @click="closeInstallConfirm()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="flex mb-4">
                                <div class="flex-shrink-0 mr-3">
                                    <div class="flex items-center justify-center h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400"></i>
                                    </div>
                                </div>
                                <div class="mt-3 text-center sm:mt-0 sm:text-left">
                                    <div class="mt-2">
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            您即将安装插件 
                                            <span class="font-medium text-gray-900 dark:text-white" x-text="confirmInstallPlugin ? confirmInstallPlugin.name || confirmInstallPluginId : confirmInstallPluginId"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-lg border border-yellow-200 dark:border-yellow-800 p-4 mb-4">
                                <div class="text-yellow-700 dark:text-yellow-200 text-sm">
                                    <p class="font-medium mb-2">安装风险提示：</p>
                                    <ul class="list-disc pl-4 space-y-1">
                                        <li>插件可能修改服务器行为或访问服务器资源</li>
                                        <li>确保插件来源可信，避免安全风险</li>
                                        <li>建议在测试环境中先行验证</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                请选择安装方式：
                            </p>
                        </div>
                        
                        <div class="modal-footer">
                            <button @click="closeInstallConfirm()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                                <i class="fas fa-times mr-1.5"></i>
                                <span>取消</span>
                            </button>
                            <button @click="showPluginVersions(confirmInstallPluginId)" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                                <i class="fas fa-tags mr-1.5"></i>
                                <span>选择版本</span>
                            </button>
                            <button @click="installPluginDirectly(confirmInstallPluginId)" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                <i class="fas fa-download mr-1.5"></i>
                                <span>安装（最新）</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 版本选择模态窗口 -->
                <div x-show="showVersionModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" @click.away="closeVersionModal()">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="'插件版本选择 - ' + (currentVersionPlugin ? currentVersionPlugin.id : '')"></h3>
                            <button @click="closeVersionModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <!-- 加载状态 -->
                            <div x-show="versionsLoading" class="flex justify-center items-center py-12">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                                <span class="ml-3 text-gray-600 dark:text-gray-400">加载插件版本中...</span>
                            </div>
                            
                            <!-- 错误信息 -->
                            <div x-show="versionError" class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4">
                                <div class="flex">
                                    <i class="fas fa-exclamation-circle text-red-500 mr-2 mt-0.5"></i>
                                    <span class="text-red-700 dark:text-red-300" x-text="versionErrorMessage"></span>
                                </div>
                            </div>

                            <!-- 版本列表 -->
                            <div x-show="!versionsLoading && versions.length === 0 && !versionError" class="text-center py-12">
                                <i class="fas fa-tag text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-500 dark:text-gray-400">未找到可用版本</p>
                            </div>

                            <div x-show="!versionsLoading && versions.length > 0" class="space-y-4">
                                <p class="text-sm text-gray-600 dark:text-gray-300">当前安装版本: <span x-text="installedVersion || '未安装'" class="font-medium"></span></p>
                                
                                <div class="grid gap-3">
                                    <template x-for="version in versions" :key="version.version">
                                        <div 
                                            @click="version.installed ? null : switchPluginVersion(version.version)" 
                                            class="bg-white dark:bg-gray-800 border rounded-lg p-4 transition-shadow"
                                            :class="[
                                                version.installed ? 
                                                    'border-green-500 dark:border-green-600' : 
                                                    'border-gray-200 dark:border-gray-700 hover:shadow-md cursor-pointer',
                                                {
                                                    'opacity-50 cursor-not-allowed': version.processing || version.installed
                                                }
                                            ]"
                                        >
                                            <div class="flex justify-between items-start mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-lg font-semibold" x-text="version.version"></span>
                                                    <span 
                                                        x-show="version.installed" 
                                                        class="ml-2 px-2 py-0.5 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full"
                                                    >
                                                        已安装
                                                    </span>
                                                    <span 
                                                        x-show="version.prerelease" 
                                                        class="ml-2 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs rounded-full"
                                                    >
                                                        预发布
                                                    </span>
                                                </div>
                                                <span class="text-sm text-gray-500 dark:text-gray-400" x-text="formatDate(version.release_date)"></span>
                                            </div>
                                            
                                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mt-1">
                                                <i class="fas fa-download mr-1"></i>
                                                <span x-text="formatNumber(version.download_count)"></span>
                                            </div>
                                            
                                            <div x-show="version.description" class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                                <p x-text="version.description"></p>
                                            </div>
                                            
                                            <div x-show="version.processing" class="mt-3 flex items-center text-blue-600 dark:text-blue-400">
                                                <i class="fas fa-circle-notch fa-spin mr-2"></i>
                                                <span>正在处理...</span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button @click="closeVersionModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors">
                                <span>关闭</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 第三方仓库警告模态窗口 -->
                <div x-show="showRepoWarningModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header bg-yellow-100 dark:bg-yellow-900 border-b border-yellow-200 dark:border-yellow-700">
                            <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span>第三方仓库安全警告</span>
                            </h3>
                            <button @click="cancelRepoWarning()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg border border-yellow-200 dark:border-yellow-800 mb-4">
                                <p class="text-yellow-700 dark:text-yellow-200 font-medium">您正在访问第三方插件仓库</p>
                            </div>
                            
                            <div class="space-y-4 text-gray-700 dark:text-gray-300">
                                <p>请注意：</p>
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>这些插件可能没有经过审查，可能存在潜在安全风险。</li>
                                    <li>安装这些插件可能会影响您的服务器的稳定性和安全性。</li>
                                    <li>在安装前，请仔细审查插件代码或确认您信任该仓库的维护者。</li>
                                    <li>第三方插件不会支持版本切换功能，本弹窗在你确认后当天将不再显示。</li>
                                </ul>
                                <p>继续访问即表示您了解并接受这些风险。</p>
                            </div>
                        </div>
                        
                        <div class="modal-footer bg-gray-50 dark:bg-gray-800">
                            <button 
                                @click="cancelRepoWarning()" 
                                class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                            >
                                <span>取消</span>
                            </button>
                            
                            <button 
                                @click="confirmRepoWarning()" 
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors"
                            >
                                <span>我了解风险并继续</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 页脚 -->
                <footer class="mt-8 text-center text-gray-600 dark:text-gray-400 text-sm">
                    <p>MCDR WebUI &copy; <span id="year"></span></p>
                </footer>
            </main>
        </div>
    </div>

    <!-- 导入主脚本 -->
    <script src="js/main.js"></script>
    
    <!-- 公告脚本 -->
    <script src="js/notice.js"></script>

    <!-- 在线插件页面脚本 -->
    <script src="js/online-plugins.js"></script>
</body>
</html> 