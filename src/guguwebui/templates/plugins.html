<!DOCTYPE html>
<html lang="zh-CN" class="h-full" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true', sidebarOpen: window.innerWidth >= 1024 }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    
    <title data-i18n="plugins.title"></title>
    <!-- 主题预加载脚本 - 防止闪烁 -->
    <script src="js/theme-preload.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js -->
    <script defer src="js/alpine.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 自定义CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/plugins.css">
    <!-- i18n -->
    <script defer src="js/i18n.js"></script>
    <!-- 自定义配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                },
            },
        }
    </script>
    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/properties/properties.min.js"></script>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div x-data="pluginsData" x-init="init()">
        <!-- 侧边栏 -->
        {% include "sideNavigator.html" %}
        
        <!-- 主内容区 -->
        <div id="main-content" :class="{'sidebar-open': sidebarOpen}" class="main-content min-h-screen transition-all duration-300">
            <!-- 顶部导航栏 -->
            <header id="header" class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 h-16 fixed top-0 right-0 left-0 z-20" :class="{'left-0': !sidebarOpen, 'left-[260px]': sidebarOpen}">
                <div class="h-full px-4 sm:px-6 flex items-center justify-between">
                    <!-- 左侧部分 -->
                    <div class="flex items-center">
                        <!-- 移动端菜单按钮 -->
                        <button @click="sidebarOpen = !sidebarOpen" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none transition-colors">
                            <i :class="sidebarOpen ? 'fa-times' : 'fa-bars'" class="fas"></i>
                        </button>
                        
                        <!-- 页面标题 -->
                        <h1 class="ml-4 text-xl font-semibold text-gray-800 dark:text-white" data-i18n="page.plugins.title"></h1>
                    </div>
                    
                    <!-- 右侧部分 -->
                    <div class="flex items-center space-x-4">
                        <!-- 公告 -->
                        <div class="nav-notice hidden md:flex items-center bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-1 rounded-full text-xs font-medium mr-2">
                            <span class="nav-notice-text"><i class="fas fa-circle-notch fa-spin mr-1.5"></i> <span data-i18n="common.notice_loading"></span></span>
                        </div>
                    
                        <!-- 服务器状态 -->
                        <div class="hidden sm:flex items-center">
                            <div class="px-3 py-1 rounded-full text-xs font-medium flex items-center" :class="{
                                'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300': serverStatus === 'online',
                                'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300': serverStatus === 'offline',
                                'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300': serverStatus === 'error',
                                'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300': serverStatus === 'loading'
                            }">
                                <span x-show="serverStatus === 'online'" class="flex items-center">
                                    <i class="fas fa-circle mr-1 text-xs"></i>
                                    <span data-i18n="nav.status_online"></span>
                                </span>
                                <span x-show="serverStatus === 'offline'" class="flex items-center">
                                    <i class="fas fa-circle mr-1 text-xs"></i>
                                    <span data-i18n="nav.status_offline"></span>
                                </span>
                                <span x-show="serverStatus === 'error'" class="flex items-center">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    <span data-i18n="nav.status_error"></span>
                                </span>
                                <span x-show="serverStatus === 'loading'" class="flex items-center">
                                    <i class="fas fa-circle-notch fa-spin mr-1 text-xs"></i>
                                    <span data-i18n="nav.status_loading"></span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- 主题切换 -->
                        <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none transition-colors">
                            <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                        </button>
                        
                        <!-- 用户信息 -->
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white user-avatar overflow-hidden">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300 js-username" x-text="userName || ''"></span>
                            <span x-show="!userName" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300" data-i18n="common.user"></span>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- 主内容 -->
            <main class="pt-24 px-4 sm:px-6 md:px-8 pb-8">
                <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg p-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white" data-i18n="plugins.title"></h2>
                        
                        <!-- 搜索栏 -->
                        <div class="relative w-full md:w-64">
                            <input 
                                type="text" 
                                class="w-full pl-10 pr-4 py-2 rounded-lg border dark:border-gray-700 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"
                                data-i18n-placeholder="plugins.search_placeholder"
                                x-model="searchQuery"
                            >
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            <button 
                                x-show="searchQuery" 
                                @click="searchQuery = ''"
                                class="absolute right-3 top-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                            >
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- 刷新按钮 -->
                        <button 
                            @click="loadPlugins" 
                            class="inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                            :disabled="loading"
                        >
                            <template x-if="!loading">
                                <i class="fas fa-sync-alt mr-2"></i>
                            </template>
                            <template x-if="loading">
                                <i class="fas fa-circle-notch fa-spin mr-2"></i>
                            </template>
                            <span x-show="loading" data-i18n="plugins.loading"></span>
                            <span x-show="!loading" data-i18n="plugins.refresh_plugins"></span>
                        </button>
                    </div>

                    <!-- 加载状态 -->
                    <div x-show="loading" class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                        <span class="ml-3 text-gray-600 dark:text-gray-400" data-i18n="plugins.loading_plugins"></span>
                    </div>

                    <!-- 插件列表 -->
                    <div x-show="!loading && filterPlugins().length === 0" class="text-center py-12">
                        <i class="fas fa-puzzle-piece text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400" data-i18n="plugins.no_plugins_found"></p>
                    </div>

                    <div x-show="!loading && filterPlugins().length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="plugin in filterPlugins()" :key="plugin.id">
                            <div class="plugin-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden"
                                :class="getPluginStatus(plugin)">
                                <div class="p-5 h-full flex flex-col">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="plugin.name || plugin.id"></h3>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                                <span data-i18n="plugins.plugin_id"></span>
                                                <span x-text="plugin.id"></span>
                                            </p>
                                        </div>
                                        <div x-show="plugin.id !== 'guguwebui'">
                                            <label class="toggle-switch">
                                                <input 
                                                    type="checkbox" 
                                                    :checked="plugin.status === true || plugin.status === 'loaded'"
                                                    @change="togglePlugin(plugin.id, !(plugin.status === true || plugin.status === 'loaded'))"
                                                    :disabled="processingPlugins[plugin.id] || plugin.id === 'guguwebui'"
                                                >
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <p x-show="getPluginDescription(plugin)" class="text-sm text-gray-600 dark:text-gray-300" x-text="getPluginDescription(plugin)"></p>
                                        <p x-show="!getPluginDescription(plugin)" class="text-sm text-gray-600 dark:text-gray-300" data-i18n="plugins.no_description"></p>
                                    </div>
                                    
                                    <div class="mt-4 flex flex-wrap gap-2">
                                        <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-200 rounded">
                                            <span data-i18n="plugins.version"></span>
                                            <span x-text="plugin.version || ''"></span>
                                            <span x-show="!plugin.version" data-i18n="plugins.unknown_version"></span>
                                        </span>
                                        <template x-if="plugin.version !== plugin.version_latest">
                                            <span class="text-xs px-2 py-1 rounded flex items-center"
                                                :class="compareVersions(plugin.version, plugin.version_latest) > 0 ? 
                                                    'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-200' : 
                                                    'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-200'">
                                                <span x-show="compareVersions(plugin.version, plugin.version_latest) > 0" data-i18n="plugins.local_version_higher"></span>
                                                <span x-show="compareVersions(plugin.version, plugin.version_latest) <= 0" data-i18n="plugins.can_update"></span>
                                                <span data-i18n="plugins.version"></span>
                                                <span x-text="plugin.version_latest"></span>
                                            </span>
                                        </template>
                                        <span x-show="plugin.author" class="text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-200 rounded">
                                            <span data-i18n="plugins.author"></span>
                                            <span x-text="plugin.author"></span>
                                        </span>
                                        <a x-show="plugin.github && plugin.github !== 'None'" :href="plugin.github" target="_blank" class="text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700/50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 rounded inline-flex items-center">
                                            <i class="fab fa-github mr-1"></i>
                                            <span data-i18n="plugins.github"></span>
                                        </a>
                                        <!-- 添加仓库信息标签 -->
                                        <span x-show="plugin.repository" class="text-xs px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-200 rounded inline-flex items-center">
                                            <i class="fas fa-server mr-1"></i>
                                            <span x-text="plugin.repository"></span>
                                        </span>
                                        <span x-show="plugin.status === true || plugin.status === 'loaded'" class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-200 rounded">
                                            <i class="fas fa-check-circle mr-1"></i>
                                            <span data-i18n="plugins.loaded"></span>
                                        </span>
                                        <span x-show="plugin.status === false || plugin.status === 'disabled'" class="text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded">
                                            <i class="fas fa-pause-circle mr-1"></i>
                                            <span data-i18n="plugins.disabled"></span>
                                        </span>
                                        <span x-show="plugin.status === 'unloaded'" class="text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-200 rounded">
                                            <i class="fas fa-exclamation-circle mr-1"></i>
                                            <span data-i18n="plugins.unloaded"></span>
                                        </span>
                                    </div>
                                    
                                    <div class="mt-auto pt-5 flex flex-wrap justify-end space-x-3">
                                        <button 
                                            x-show="plugin.id !== 'guguwebui' && plugin.config_file === true"
                                            @click="openConfigModal(plugin)"
                                            class="mt-2 inline-flex items-center justify-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none transition-colors"
                                        >
                                            <i class="fas fa-cog mr-1.5"></i>
                                            <span data-i18n="plugins.config"></span>
                                        </button>
                                        
                                        <button 
                                            x-show="plugin.id !== 'guguwebui'"
                                            @click="reloadPlugin(plugin.id)"
                                            class="mt-2 inline-flex items-center justify-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                            :disabled="processingPlugins[plugin.id]"
                                        >
                                            <template x-if="!processingPlugins[plugin.id]">
                                                <i class="fas fa-sync-alt mr-1.5"></i>
                                            </template>
                                            <template x-if="processingPlugins[plugin.id]">
                                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                            </template>
                                            <span data-i18n="plugins.reload"></span>
                                        </button>
                                        
                                        <button 
                                            x-show="plugin.id !== 'guguwebui'"
                                            @click="uninstallPlugin(plugin.id)"
                                            class="mt-2 inline-flex items-center justify-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none transition-colors"
                                            :disabled="processingPlugins[plugin.id]"
                                        >
                                            <template x-if="!processingPlugins[plugin.id]">
                                                <i class="fas fa-trash-alt mr-1.5"></i>
                                            </template>
                                            <template x-if="processingPlugins[plugin.id]">
                                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                            </template>
                                            <span data-i18n="plugins.uninstall"></span>
                                        </button>
                                        
                                        <button 
                                            x-show="plugin.id !== 'guguwebui' && plugin.version !== plugin.version_latest"
                                            @click="updatePlugin(plugin.id)"
                                            class="mt-2 inline-flex items-center justify-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none transition-colors"
                                            :disabled="processingPlugins[plugin.id]"
                                        >
                                            <template x-if="!processingPlugins[plugin.id]">
                                                <i class="fas fa-arrow-circle-up mr-1.5"></i>
                                            </template>
                                            <template x-if="processingPlugins[plugin.id]">
                                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                            </template>
                                            <span data-i18n="plugins.update"></span>
                                        </button>
                                        
                                        <!-- 版本切换按钮 -->
                                        <button 
                                            x-show="plugin.id !== 'guguwebui'"
                                            @click="showPluginVersions(plugin)"
                                            class="mt-2 inline-flex items-center justify-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors"
                                            :disabled="processingPlugins[plugin.id]"
                                        >
                                            <template x-if="!processingPlugins[plugin.id]">
                                                <i class="fas fa-tags mr-1.5"></i>
                                            </template>
                                            <template x-if="processingPlugins[plugin.id]">
                                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                            </template>
                                            <span data-i18n="plugins.versions"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- 通知 -->
                <div 
                    x-show="showNotification" 
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-90"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-90"
                    class="notification"
                    :class="notificationType === 'success' ? 'bg-green-500' : 'bg-red-500'"
                >
                    <template x-if="notificationType === 'success'">
                        <i class="fas fa-check-circle mr-2"></i>
                    </template>
                    <template x-if="notificationType === 'error'">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                    </template>
                    <span x-text="notificationMessage"></span>
                </div>
                
                <!-- 配置文件模态窗口 -->
                <div x-show="showConfigModal" x-transition.opacity class="modal-backdrop">
                    <div class="modal-content" @click.away="closeConfigModal()">
                        <div class="modal-header">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                <template x-if="currentPlugin">
                                    <span>
                                        <span data-i18n="plugins.config_modal.title"></span>
                                        <span> - </span>
                                        <span x-text="currentPlugin && (currentPlugin.name || currentPlugin.id)"></span>
                                    </span>
                                </template>
                                <template x-if="!currentPlugin">
                                    <span data-i18n="plugins.config_modal.title"></span>
                                </template>
                            </h3>
                            <button @click="closeConfigModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <!-- 配置文件列表 -->
                            <div x-show="!showEditor">
                                <h4 class="text-md font-medium text-gray-800 dark:text-gray-200 mb-4" data-i18n="plugins.config_modal.available_configs"></h4>
                                
                                <div x-show="configFiles.length === 0" class="text-center py-10 text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-file-alt text-4xl mb-3"></i>
                                    <p data-i18n="plugins.config_modal.no_config_files"></p>
                                </div>
                                
                                <div x-show="configFiles.length > 0" class="config-file-list">
                                    <template x-for="file in configFiles" :key="file">
                                        <div class="config-file-item">
                                            <div>
                                                <span class="text-gray-900 dark:text-gray-100 font-medium" x-text="file.split('/').pop()"></span>
                                                <span class="text-gray-500 dark:text-gray-400 text-sm ml-2" x-text="file"></span>
                                            </div>
                                            <div class="flex gap-2">
                                                <button @click="openConfigFile(file, 'form')" class="inline-flex items-center px-3 py-1.5 bg-purple-100 hover:bg-purple-200 dark:bg-purple-900/30 dark:hover:bg-purple-800/40 text-purple-700 dark:text-purple-300 rounded-md text-sm">
                                                    <i class="fas fa-list-alt mr-1.5"></i>
                                                    <span data-i18n="plugins.config_modal.form_mode"></span>
                                                </button>
                                                <button @click="openConfigFile(file, 'code')" class="inline-flex items-center px-3 py-1.5 bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/30 dark:hover:bg-blue-800/40 text-blue-700 dark:text-blue-300 rounded-md text-sm">
                                                    <i class="fas fa-code mr-1.5"></i>
                                                    <span data-i18n="plugins.config_modal.code_mode"></span>
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- 编辑器界面 -->
                            <div x-show="showEditor">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-200">
                                        <span data-i18n="plugins.config_modal.edit_file"></span>
                                        <span> </span>
                                        <span class="text-blue-600 dark:text-blue-400" x-text="selectedFile.split('/').pop()"></span>
                                    </h4>
                                    <button @click="closeEditor()" class="inline-flex items-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                        <i class="fas fa-arrow-left mr-1.5"></i>
                                        <span data-i18n="plugins.config_modal.back_to_list"></span>
                                    </button>
                                </div>
                                
                                <div class="editor-tabs">
                                    <div class="editor-tab" :class="{ 'active': editorMode === 'code' }" @click="editorMode = 'code'; reloadCurrentFile('code')">
                                        <i class="fas fa-code mr-1.5"></i>
                                        <span data-i18n="plugins.config_modal.code_view"></span>
                                    </div>
                                    <div class="editor-tab" :class="{ 'active': editorMode === 'form' }" @click="editorMode = 'form'; reloadCurrentFile('form')">
                                        <i class="fas fa-list-alt mr-1.5"></i>
                                        <span data-i18n="plugins.config_modal.form_view"></span>
                                    </div>
                                </div>
                                
                                <!-- 代码编辑器 -->
                                <div x-show="editorMode === 'code'" class="editor-container">
                                    <textarea id="config-editor" x-model="configContent"></textarea>
                                </div>
                                
                                <!-- 表单视图 -->
                                <div x-show="editorMode === 'form'" class="mt-4">
                                    <!-- HTML内容渲染区域 -->
                                    <div x-show="configData && configData.type === 'html'" class="config-html-content">
                                        <div class="html-iframe-container">
                                            <iframe id="html-config-iframe" class="html-iframe" x-ref="htmlIframe" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
                                        </div>
                                    </div>
                                    
                                    <!-- 标准表单渲染区域 -->
                                    <div x-show="!configData || configData.type !== 'html'">
                                        <div x-show="!configData || Object.keys(configData).length === 0" class="text-center py-10 text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-exclamation-circle text-4xl mb-3"></i>
                                            <p data-i18n="plugins.config_modal.cannot_edit_form"></p>
                                            <p class="text-sm mt-2" data-i18n="plugins.config_modal.try_code_view"></p>
                                        </div>
                                        
                                        <!-- 动态表单内容 - 支持深层嵌套对象 -->
                                        <div x-show="configData && Object.keys(configData).length > 0 && configData.type !== 'html'" class="space-y-4">
                                            <template x-for="(value, key) in configData || {}" :key="key">
                                                <div class="form-group">
                                                    <label class="block text-sm font-medium mb-1 config-label">
                                                        <!-- 如果有翻译且是数组 (标题+副标题) -->
                                                        <template x-if="configTranslations[key] && Array.isArray(configTranslations[key]) && configTranslations[key].length > 0">
                                                            <div>
                                                                <span class="config-label-title" x-text="configTranslations[key][0] || key"></span>
                                                                <span x-show="configTranslations[key].length > 1" class="config-label-subtitle" x-text="configTranslations[key][1]"></span>
                                                            </div>
                                                        </template>
                                                        <!-- 如果有翻译且是字符串 (只有标题) -->
                                                        <template x-if="configTranslations[key] && !Array.isArray(configTranslations[key])">
                                                            <span class="config-label-title" x-text="configTranslations[key]"></span>
                                                        </template>
                                                        <!-- 没有翻译时显示原键名 -->
                                                        <template x-if="!configTranslations[key]">
                                                            <span class="config-label-title" x-text="key"></span>
                                                        </template>
                                                    </label>
                                                    
                                                    <!-- 根据值类型渲染不同控件 -->
                                                    <template x-if="typeof value === 'boolean'">
                                                        <label class="toggle-switch">
                                                            <input type="checkbox" x-model="configData[key]">
                                                            <span class="toggle-slider"></span>
                                                        </label>
                                                    </template>
                                                    
                                                    <template x-if="typeof value === 'number'">
                                                        <input type="number" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" x-model.number="configData[key]">
                                                    </template>
                                                    
                                                    <template x-if="typeof value === 'string'">
                                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" x-model="configData[key]">
                                                    </template>
                                                    
                                                    <!-- 处理嵌套对象 -->
                                                    <template x-if="typeof value === 'object' && value !== null && !Array.isArray(value)">
                                                        <div class="mt-2 pl-4 border-l-2 border-gray-300 dark:border-gray-600 space-y-3">
                                                            <template x-for="(nestedValue, nestedKey) in value" :key="nestedKey">
                                                                <div class="form-group">
                                                                    <label class="block text-sm font-medium mb-1 config-label">
                                                                        <!-- 尝试使用嵌套路径查找翻译，如果找不到，尝试直接使用属性名 -->
                                                                        <template x-if="configTranslations[key + '.' + nestedKey] && Array.isArray(configTranslations[key + '.' + nestedKey])">
                                                                            <div>
                                                                                <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey][0] || nestedKey"></span>
                                                                                <span x-show="configTranslations[key + '.' + nestedKey].length > 1" class="config-label-subtitle" x-text="configTranslations[key + '.' + nestedKey][1]"></span>
                                                                            </div>
                                                                        </template>
                                                                        <template x-if="configTranslations[key + '.' + nestedKey] && !Array.isArray(configTranslations[key + '.' + nestedKey])">
                                                                            <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey]"></span>
                                                                        </template>
                                                                        
                                                                        <!-- 尝试直接使用属性名查找翻译（如果嵌套路径没有找到） -->
                                                                        <template x-if="!configTranslations[key + '.' + nestedKey] && configTranslations[nestedKey] && Array.isArray(configTranslations[nestedKey])">
                                                                            <div>
                                                                                <span class="config-label-title" x-text="configTranslations[nestedKey][0] || nestedKey"></span>
                                                                                <span x-show="configTranslations[nestedKey].length > 1" class="config-label-subtitle" x-text="configTranslations[nestedKey][1]"></span>
                                                                            </div>
                                                                        </template>
                                                                        <template x-if="!configTranslations[key + '.' + nestedKey] && configTranslations[nestedKey] && !Array.isArray(configTranslations[nestedKey])">
                                                                            <span class="config-label-title" x-text="configTranslations[nestedKey]"></span>
                                                                        </template>
                                                                        
                                                                        <!-- 如果没有找到任何翻译 -->
                                                                        <template x-if="!configTranslations[key + '.' + nestedKey] && !configTranslations[nestedKey]">
                                                                            <span class="config-label-title" x-text="nestedKey"></span>
                                                                        </template>
                                                                    </label>
                                                                    
                                                                    <!-- 处理嵌套对象中的值类型 -->
                                                                    <template x-if="typeof nestedValue === 'boolean'">
                                                                        <label class="toggle-switch">
                                                                            <input type="checkbox" x-model="configData[key] && (configData[key][nestedKey] = configData[key][nestedKey] || false)">
                                                                            <span class="toggle-slider"></span>
                                                                        </label>
                                                                    </template>
                                                                    
                                                                    <template x-if="typeof nestedValue === 'number'">
                                                                        <input type="number" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                            @input="if(!configData[key]) configData[key] = {}; configData[key][nestedKey] = parseFloat($event.target.value)" 
                                                                            :value="configData[key] && configData[key][nestedKey]">
                                                                    </template>
                                                                    
                                                                    <template x-if="typeof nestedValue === 'string'">
                                                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                            @input="if(!configData[key]) configData[key] = {}; configData[key][nestedKey] = $event.target.value" 
                                                                            :value="configData[key] && configData[key][nestedKey]">
                                                                    </template>
                                                                    
                                                                    <!-- 处理嵌套对象中的数组 -->
                                                                    <template x-if="Array.isArray(nestedValue)">
                                                                        <div class="mt-2 space-y-2">
                                                                            <div class="mb-2 flex gap-2 flex-wrap">
                                                                                <template x-for="(item, index) in nestedValue || []" :key="index">
                                                                                    <div class="inline-flex items-center bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full px-3 py-1 text-sm">
                                                                                        <span x-text="item"></span>
                                                                                        <button @click="configData && configData[key] && Array.isArray(configData[key][nestedKey]) && configData[key][nestedKey].splice(index, 1)" class="ml-1.5 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                                                            <i class="fas fa-times"></i>
                                                                                        </button>
                                                                                    </div>
                                                                                </template>
                                                                            </div>
                                                                            <div class="flex gap-2">
                                                                                <input 
                                                                                    type="text" 
                                                                                    placeholder="添加新项..." 
                                                                                    :id="'nested-array-input-' + (key ? key.replace(/\./g, '-') : '') + '-' + (nestedKey ? nestedKey.replace(/\./g, '-') : '')" 
                                                                                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                                                                <button 
                                                                                    @click="
                                                                                        if (!configData || !key || !nestedKey) return;
                                                                                        const inputId = 'nested-array-input-' + key.replace(/\./g, '-') + '-' + nestedKey.replace(/\./g, '-');
                                                                                        const inputEl = document.getElementById(inputId);
                                                                                        if (inputEl && inputEl.value) {
                                                                                            if (!configData[key]) configData[key] = {};
                                                                                            if (!Array.isArray(configData[key][nestedKey])) {
                                                                                                configData[key][nestedKey] = [];
                                                                                            }
                                                                                            configData[key][nestedKey].push(inputEl.value);
                                                                                            inputEl.value = '';
                                                                                        }
                                                                                    " 
                                                                                    class="inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                                                                    <i class="fas fa-plus"></i>
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </template>

                                                                    <!-- 处理第三层嵌套对象 -->
                                                                    <template x-if="typeof nestedValue === 'object' && nestedValue !== null && !Array.isArray(nestedValue)">
                                                                        <div class="mt-2 pl-4 border-l-2 border-gray-300 dark:border-gray-600 space-y-3">
                                                                            <template x-for="(thirdValue, thirdKey) in nestedValue" :key="thirdKey">
                                                                                <div class="form-group">
                                                                                    <label class="block text-sm font-medium mb-1 config-label">
                                                                                        <!-- 尝试使用嵌套路径查找翻译 -->
                                                                                        <template x-if="configTranslations[key + '.' + nestedKey + '.' + thirdKey] && Array.isArray(configTranslations[key + '.' + nestedKey + '.' + thirdKey])">
                                                                                            <div>
                                                                                                <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey][0] || thirdKey"></span>
                                                                                                <span x-show="configTranslations[key + '.' + nestedKey + '.' + thirdKey].length > 1" class="config-label-subtitle" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey][1]"></span>
                                                                                            </div>
                                                                                        </template>
                                                                                        <template x-if="configTranslations[key + '.' + nestedKey + '.' + thirdKey] && !Array.isArray(configTranslations[key + '.' + nestedKey + '.' + thirdKey])">
                                                                                            <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey]"></span>
                                                                                        </template>
                                                                                        
                                                                                        <!-- 尝试直接使用属性名查找翻译 -->
                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey] && configTranslations[thirdKey] && Array.isArray(configTranslations[thirdKey])">
                                                                                            <div>
                                                                                                <span class="config-label-title" x-text="configTranslations[thirdKey][0] || thirdKey"></span>
                                                                                                <span x-show="configTranslations[thirdKey].length > 1" class="config-label-subtitle" x-text="configTranslations[thirdKey][1]"></span>
                                                                                            </div>
                                                                                        </template>
                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey] && configTranslations[thirdKey] && !Array.isArray(configTranslations[thirdKey])">
                                                                                            <span class="config-label-title" x-text="configTranslations[thirdKey]"></span>
                                                                                        </template>
                                                                                        
                                                                                        <!-- 如果没有找到任何翻译 -->
                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey] && !configTranslations[thirdKey]">
                                                                                            <span class="config-label-title" x-text="thirdKey"></span>
                                                                                        </template>
                                                                                    </label>
                                                                                    
                                                                                    <!-- 处理第三层对象中的值类型 -->
                                                                                    <template x-if="typeof thirdValue === 'boolean'">
                                                                                        <label class="toggle-switch">
                                                                                            <input type="checkbox" @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; configData[key][nestedKey][thirdKey] = $event.target.checked" 
                                                                                                :checked="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey]">
                                                                                            <span class="toggle-slider"></span>
                                                                                        </label>
                                                                                    </template>
                                                                                    
                                                                                    <template x-if="typeof thirdValue === 'number'">
                                                                                        <input type="number" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                                            @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; configData[key][nestedKey][thirdKey] = parseFloat($event.target.value)" 
                                                                                            :value="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey]">
                                                                                    </template>
                                                                                    
                                                                                    <template x-if="typeof thirdValue === 'string'">
                                                                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                                            @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; configData[key][nestedKey][thirdKey] = $event.target.value" 
                                                                                            :value="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey]">
                                                                                    </template>
                                                                                    
                                                                                    <!-- 处理第三层嵌套中的数组 -->
                                                                                    <template x-if="Array.isArray(thirdValue)">
                                                                                        <div class="mt-2 space-y-2">
                                                                                            <div class="mb-2 flex gap-2 flex-wrap">
                                                                                                <template x-for="(item, index) in thirdValue || []" :key="index">
                                                                                                    <div class="inline-flex items-center bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full px-3 py-1 text-sm">
                                                                                                        <span x-text="item"></span>
                                                                                                        <button @click="configData && configData[key] && configData[key][nestedKey] && Array.isArray(configData[key][nestedKey][thirdKey]) && configData[key][nestedKey][thirdKey].splice(index, 1)" class="ml-1.5 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                                                                            <i class="fas fa-times"></i>
                                                                                                        </button>
                                                                                                    </div>
                                                                                                </template>
                                                                                            </div>
                                                                                            <div class="flex gap-2">
                                                                                                <input 
                                                                                                    type="text" 
                                                                                                    placeholder="添加新项..." 
                                                                                                    :id="'third-array-input-' + (key ? key.replace(/\./g, '-') : '') + '-' + (nestedKey ? nestedKey.replace(/\./g, '-') : '') + '-' + (thirdKey ? thirdKey.replace(/\./g, '-') : '')" 
                                                                                                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                                                                                <button 
                                                                                                    @click="
                                                                                                        if (!configData || !key || !nestedKey || !thirdKey) return;
                                                                                                        const inputId = 'third-array-input-' + key.replace(/\./g, '-') + '-' + nestedKey.replace(/\./g, '-') + '-' + thirdKey.replace(/\./g, '-');
                                                                                                        const inputEl = document.getElementById(inputId);
                                                                                                        if (inputEl && inputEl.value) {
                                                                                                            if (!configData[key]) configData[key] = {};
                                                                                                            if (!configData[key][nestedKey]) configData[key][nestedKey] = {};
                                                                                                            if (!configData[key][nestedKey][thirdKey]) {
                                                                                                                configData[key][nestedKey][thirdKey] = [];
                                                                                                            }
                                                                                                            configData[key][nestedKey][thirdKey].push(inputEl.value);
                                                                                                            inputEl.value = '';
                                                                                                        }
                                                                                                    " 
                                                                                                    class="inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                                                                                    <i class="fas fa-plus"></i>
                                                                                                </button>
                                                                                            </div>
                                                                                        </div>
                                                                                    </template>

                                                                                    <!-- 处理第四层嵌套对象 -->
                                                                                    <template x-if="typeof thirdValue === 'object' && thirdValue !== null && !Array.isArray(thirdValue)">
                                                                                        <div class="mt-2 pl-4 border-l-2 border-gray-300 dark:border-gray-600 space-y-3">
                                                                                            <template x-for="(fourthValue, fourthKey) in thirdValue" :key="fourthKey">
                                                                                                <div class="form-group">
                                                                                                    <label class="block text-sm font-medium mb-1 config-label">
                                                                                                        <!-- 尝试使用嵌套路径查找翻译 -->
                                                                                                        <template x-if="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey] && Array.isArray(configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey])">
                                                                                                            <div>
                                                                                                                <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey][0] || fourthKey"></span>
                                                                                                                <span x-show="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey].length > 1" class="config-label-subtitle" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey][1]"></span>
                                                                                                            </div>
                                                                                                        </template>
                                                                                                        <template x-if="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey] && !Array.isArray(configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey])">
                                                                                                            <span class="config-label-title" x-text="configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey]"></span>
                                                                                                        </template>
                                                                                                        
                                                                                                        <!-- 尝试直接使用属性名查找翻译 -->
                                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey] && configTranslations[fourthKey] && Array.isArray(configTranslations[fourthKey])">
                                                                                                            <div>
                                                                                                                <span class="config-label-title" x-text="configTranslations[fourthKey][0] || fourthKey"></span>
                                                                                                                <span x-show="configTranslations[fourthKey].length > 1" class="config-label-subtitle" x-text="configTranslations[fourthKey][1]"></span>
                                                                                                            </div>
                                                                                                        </template>
                                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey] && configTranslations[fourthKey] && !Array.isArray(configTranslations[fourthKey])">
                                                                                                            <span class="config-label-title" x-text="configTranslations[fourthKey]"></span>
                                                                                                        </template>
                                                                                                        
                                                                                                        <!-- 如果没有找到任何翻译 -->
                                                                                                        <template x-if="!configTranslations[key + '.' + nestedKey + '.' + thirdKey + '.' + fourthKey] && !configTranslations[fourthKey]">
                                                                                                            <span class="config-label-title" x-text="fourthKey"></span>
                                                                                                        </template>
                                                                                                    </label>
                                                                                                    
                                                                                                    <!-- 处理第四层对象中的值类型 -->
                                                                                                    <template x-if="typeof fourthValue === 'boolean'">
                                                                                                        <label class="toggle-switch">
                                                                                                            <input type="checkbox" @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; if(!configData[key][nestedKey][thirdKey]) configData[key][nestedKey][thirdKey] = {}; configData[key][nestedKey][thirdKey][fourthKey] = $event.target.checked" 
                                                                                                                :checked="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey] && configData[key][nestedKey][thirdKey][fourthKey]">
                                                                                                            <span class="toggle-slider"></span>
                                                                                                        </label>
                                                                                                    </template>
                                                                                                    
                                                                                                    <template x-if="typeof fourthValue === 'number'">
                                                                                                        <input type="number" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                                                            @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; if(!configData[key][nestedKey][thirdKey]) configData[key][nestedKey][thirdKey] = {}; configData[key][nestedKey][thirdKey][fourthKey] = parseFloat($event.target.value)" 
                                                                                                            :value="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey] && configData[key][nestedKey][thirdKey][fourthKey]">
                                                                                                    </template>
                                                                                                    
                                                                                                    <template x-if="typeof fourthValue === 'string'">
                                                                                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" 
                                                                                                            @input="if(!configData[key]) configData[key] = {}; if(!configData[key][nestedKey]) configData[key][nestedKey] = {}; if(!configData[key][nestedKey][thirdKey]) configData[key][nestedKey][thirdKey] = {}; configData[key][nestedKey][thirdKey][fourthKey] = $event.target.value" 
                                                                                                            :value="configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey] && configData[key][nestedKey][thirdKey][fourthKey]">
                                                                                                    </template>
                                                                                                    
                                                                                                    <!-- 处理第四层嵌套中的数组 -->
                                                                                                    <template x-if="Array.isArray(fourthValue)">
                                                                                                        <div class="mt-2 space-y-2">
                                                                                                            <div class="mb-2 flex gap-2 flex-wrap">
                                                                                                                <template x-for="(item, index) in fourthValue || []" :key="index">
                                                                                                                    <div class="inline-flex items-center bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full px-3 py-1 text-sm">
                                                                                                                        <span x-text="item"></span>
                                                                                                                        <button @click="configData && configData[key] && configData[key][nestedKey] && configData[key][nestedKey][thirdKey] && Array.isArray(configData[key][nestedKey][thirdKey][fourthKey]) && configData[key][nestedKey][thirdKey][fourthKey].splice(index, 1)" class="ml-1.5 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                                                                                            <i class="fas fa-times"></i>
                                                                                                                        </button>
                                                                                                                    </div>
                                                                                                                </template>
                                                                                                            </div>
                                                                                                            <div class="flex gap-2">
                                                                                                                <input 
                                                                                                                    type="text" 
                                                                                                                    placeholder="添加新项..." 
                                                                                                                    :id="'fourth-array-input-' + (key ? key.replace(/\./g, '-') : '') + '-' + (nestedKey ? nestedKey.replace(/\./g, '-') : '') + '-' + (thirdKey ? thirdKey.replace(/\./g, '-') : '') + '-' + (fourthKey ? fourthKey.replace(/\./g, '-') : '')" 
                                                                                                                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                                                                                                <button 
                                                                                                                    @click="
                                                                                                                        if (!configData || !key || !nestedKey || !thirdKey || !fourthKey) return;
                                                                                                                        const inputId = 'fourth-array-input-' + key.replace(/\./g, '-') + '-' + nestedKey.replace(/\./g, '-') + '-' + thirdKey.replace(/\./g, '-') + '-' + fourthKey.replace(/\./g, '-');
                                                                                                                        const inputEl = document.getElementById(inputId);
                                                                                                                        if (inputEl && inputEl.value) {
                                                                                                                            if (!configData[key]) configData[key] = {};
                                                                                                                            if (!configData[key][nestedKey]) configData[key][nestedKey] = {};
                                                                                                                            if (!configData[key][nestedKey][thirdKey]) configData[key][nestedKey][thirdKey] = {};
                                                                                                                            if (!configData[key][nestedKey][thirdKey][fourthKey]) {
                                                                                                                                configData[key][nestedKey][thirdKey][fourthKey] = [];
                                                                                                                            }
                                                                                                                            configData[key][nestedKey][thirdKey][fourthKey].push(inputEl.value);
                                                                                                                            inputEl.value = '';
                                                                                                                        }
                                                                                                                    " 
                                                                                                                    class="inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                                                                                                    <i class="fas fa-plus"></i>
                                                                                                                </button>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </template>
                                                                                                </div>
                                                                                            </template>
                                                                                        </div>
                                                                                    </template>
                                                                                </div>
                                                                            </template>
                                                                        </div>
                                                                    </template>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </template>
                                                    
                                                    <!-- 处理顶层数组 -->
                                                    <template x-if="Array.isArray(value)">
                                                        <div class="mt-2 space-y-2">
                                                            <div class="mb-2 flex gap-2 flex-wrap">
                                                                <template x-for="(item, index) in value || []" :key="index">
                                                                    <div class="inline-flex items-center bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full px-3 py-1 text-sm">
                                                                        <span x-text="item"></span>
                                                                        <button @click="configData && Array.isArray(configData[key]) && configData[key].splice(index, 1)" class="ml-1.5 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300">
                                                                            <i class="fas fa-times"></i>
                                                                        </button>
                                                                    </div>
                                                                </template>
                                                            </div>
                                                            <div class="flex gap-2">
                                                                <input 
                                                                    type="text" 
                                                                    placeholder="添加新项..." 
                                                                    :id="'array-input-' + (key ? key.replace(/\./g, '-') : '')" 
                                                                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                                                <button 
                                                                    @click="
                                                                        if (!configData || !key) return;
                                                                        const inputId = 'array-input-' + key.replace(/\./g, '-');
                                                                        const inputEl = document.getElementById(inputId);
                                                                        if (inputEl && inputEl.value) {
                                                                            if (!Array.isArray(configData[key])) {
                                                                                configData[key] = [];
                                                                            }
                                                                            configData[key].push(inputEl.value);
                                                                            inputEl.value = '';
                                                                        }
                                                                    " 
                                                                    class="inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                                                                    <i class="fas fa-plus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button @click="closeConfigModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                                <span data-i18n="plugins.close"></span>
                            </button>
                            <button 
                                x-show="showEditor"
                                @click="saveConfigFile()"
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none"
                            >
                                <i class="fas fa-save mr-1.5"></i>
                                <span data-i18n="plugins.save"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 页脚 -->
            <footer class="mt-8 text-center text-gray-600 dark:text-gray-400 text-sm">
                <p data-i18n="common.copyright"></p>
            </footer>
        </main>
        
        <!-- 插件安装/更新进度模态窗口 -->
        <div x-show="showInstallModal" x-transition.opacity class="modal-backdrop">
            <div class="modal-content" @click.away="closeInstallModal()">
                <div class="modal-header">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                        <span x-show="installStatus === 'running' && installPluginId">
                            <span x-show="installMessage.includes('卸载')" data-i18n="plugins.install_modal.uninstall_progress"></span>
                            <span x-show="installMessage.includes('更新')" data-i18n="plugins.install_modal.update_progress"></span>
                            <span x-show="!installMessage.includes('卸载') && !installMessage.includes('更新')" data-i18n="plugins.install_modal.install_progress"></span>
                            <span x-text="installPluginId"></span>
                        </span>
                        <span x-show="!(installStatus === 'running' && installPluginId)">
                            <span data-i18n="plugins.install_modal.operation_progress"></span>
                            <span x-text="installPluginId"></span>
                        </span>
                    </h3>
                    <button @click="closeInstallModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <!-- 进度条 -->
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="installMessage"></span>
                            <span id="install-progress-text" class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="Math.round(installProgress) + '%'"></span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                            <div id="install-progress-bar" class="bg-blue-600 h-2.5 rounded-full" :style="'width: ' + installProgress + '%'"></div>
                        </div>
                    </div>
                    
                    <!-- 安装状态指示器 -->
                    <div class="flex items-center mb-4">
                        <div class="px-3 py-1 rounded-full text-xs font-medium flex items-center" :class="{
                            'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300': installStatus === 'running',
                            'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300': installStatus === 'completed',
                            'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300': installStatus === 'failed',
                            'bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300': installStatus === 'pending'
                        }">
                            <span x-show="installStatus === 'running'" class="flex items-center">
                                <i class="fas fa-circle-notch fa-spin mr-1.5"></i>
                                <span data-i18n="plugins.install_modal.processing"></span>
                            </span>
                            <span x-show="installStatus === 'completed'" class="flex items-center">
                                <i class="fas fa-check-circle mr-1.5"></i>
                                <span data-i18n="plugins.install_modal.completed"></span>
                            </span>
                            <span x-show="installStatus === 'failed'" class="flex items-center">
                                <i class="fas fa-exclamation-circle mr-1.5"></i>
                                <span data-i18n="plugins.install_modal.failed"></span>
                            </span>
                            <span x-show="installStatus === 'pending'" class="flex items-center">
                                <i class="fas fa-hourglass-start mr-1.5"></i>
                                <span data-i18n="plugins.install_modal.pending"></span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- 安装日志 -->
                    <div class="mt-4">
                        <h4 class="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2" data-i18n="plugins.install_modal.processing_logs"></h4>
                        <div class="bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md p-3 h-56 overflow-y-auto font-mono text-xs">
                            <template x-for="(message, index) in installLogMessages" :key="index">
                                <div class="py-0.5" :class="{'text-red-500': message.includes('错误') || message.includes('失败') || message.includes('⚠'), 'text-green-500': message.includes('成功') || message.includes('✓')}">
                                    <span x-text="message"></span>
                                </div>
                            </template>
                            <div x-show="installLogMessages.length === 0" class="text-gray-500 dark:text-gray-400">
                                <span data-i18n="plugins.install_modal.waiting_logs"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button @click="closeInstallModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                        <span x-show="installStatus === 'running'" data-i18n="plugins.hide"></span>
                        <span x-show="installStatus !== 'running'" data-i18n="plugins.close"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 确认操作模态窗口 -->
        <div x-show="showConfirmModal" x-transition.opacity class="modal-backdrop">
            <div class="modal-content max-w-md" @click.away="closeConfirmModal()">
                <div class="modal-header">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white" x-text="confirmTitle"></h3>
                    <button @click="closeConfirmModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="flex mb-4">
                        <div class="flex-shrink-0 mr-3">
                            <div class="flex items-center justify-center h-10 w-10 rounded-full" :class="{
                                'bg-blue-100 dark:bg-blue-900/30': confirmType === 'install',
                                'bg-yellow-100 dark:bg-yellow-900/30': confirmType === 'update' || confirmType === 'reload',
                                'bg-red-100 dark:bg-red-900/30': confirmType === 'uninstall'
                            }">
                                <i class="fas" :class="{
                                    'fa-download text-blue-600 dark:text-blue-400': confirmType === 'install',
                                    'fa-sync text-yellow-600 dark:text-yellow-400': confirmType === 'update' || confirmType === 'reload',
                                    'fa-trash-alt text-red-600 dark:text-red-400': confirmType === 'uninstall'
                                }"></i>
                            </div>
                        </div>
                        <div>
                            <p class="text-gray-700 dark:text-gray-300" x-text="confirmMessage"></p>
                            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400" x-show="confirmType === 'uninstall'">
                                <i class="fas fa-exclamation-triangle mr-1 text-yellow-500"></i>
                                <span data-i18n="plugins.confirm_modal.uninstall_warning"></span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button @click="closeConfirmModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none">
                        <span data-i18n="plugins.cancel"></span>
                    </button>
                    <button 
                        @click="executeConfirmedAction()"
                        class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none"
                        :class="{
                            'bg-blue-600 hover:bg-blue-700': confirmType === 'install',
                            'bg-yellow-600 hover:bg-yellow-700': confirmType === 'update' || confirmType === 'reload',
                            'bg-red-600 hover:bg-red-700': confirmType === 'uninstall'
                        }"
                    >
                        <i class="fas mr-1.5" :class="{
                            'fa-download': confirmType === 'install',
                            'fa-sync': confirmType === 'update' || confirmType === 'reload',
                            'fa-trash-alt': confirmType === 'uninstall'
                        }"></i>
                        <span x-show="confirmType === 'install'" data-i18n="plugins.confirm_modal.confirm_install"></span>
                        <span x-show="confirmType === 'update'" data-i18n="plugins.confirm_modal.confirm_update"></span>
                        <span x-show="confirmType === 'reload'" data-i18n="plugins.confirm_modal.confirm_reload"></span>
                        <span x-show="confirmType === 'uninstall'" data-i18n="plugins.confirm_modal.confirm_uninstall"></span>
                        <span x-show="!['install', 'update', 'reload', 'uninstall'].includes(confirmType)" data-i18n="plugins.confirm"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 版本切换模态窗口 -->
        <div x-show="showVersionModal" x-transition.opacity class="modal-backdrop">
            <div class="modal-content" @click.away="closeVersionModal()">
                <div class="modal-header">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                        <span data-i18n="plugins.version_modal.title"></span>
                        <span x-text="currentVersionPlugin ? currentVersionPlugin.id : ''"></span>
                    </h3>
                    <button @click="closeVersionModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <!-- 加载状态 -->
                    <div x-show="versionsLoading" class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                        <span class="ml-3 text-gray-600 dark:text-gray-400" data-i18n="plugins.version_modal.loading_versions"></span>
                    </div>
                    
                    <!-- 错误信息 -->
                    <div x-show="versionError" class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span x-text="versionErrorMessage"></span>
                    </div>

                    <!-- 版本列表 -->
                    <div x-show="!versionsLoading && versions.length === 0" class="text-center py-12">
                        <i class="fas fa-tag text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400" data-i18n="plugins.version_modal.no_versions"></p>
                    </div>

                    <div x-show="!versionsLoading && versions.length > 0" class="space-y-4">
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                            <span data-i18n="plugins.version_modal.current_version"></span>
                            <span x-text="installedVersion || ''"></span>
                            <span x-show="!installedVersion" data-i18n="plugins.version_modal.not_installed"></span>
                        </p>
                        
                        <!-- 添加仓库信息显示 -->
                        <div x-show="currentPluginRepository" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3">
                            <div class="flex items-center text-sm text-gray-600 dark:text-gray-300">
                                <i class="fas fa-server mr-2 text-orange-500"></i>
                                <span data-i18n="plugins.version_modal.source_repository"></span>
                                <span class="font-medium ml-1" x-text="currentPluginRepository && currentPluginRepository.name"></span>
                                <span x-show="currentPluginRepository && currentPluginRepository.is_official" class="ml-2 px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs rounded-full">
                                    <span data-i18n="plugins.version_modal.official"></span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid gap-3">
                            <template x-for="version in versions" :key="version.version">
                                <div 
                                    @click="version.installed ? null : switchPluginVersion(version.version)" 
                                    class="bg-white dark:bg-gray-800 border rounded-lg p-4 transition-shadow"
                                    :class="[
                                        version.installed ? 
                                            'border-green-500 dark:border-green-600' : 
                                            'border-gray-200 dark:border-gray-700 hover:shadow-md cursor-pointer',
                                        {
                                            'opacity-50 cursor-not-allowed': version.processing || version.installed
                                        }
                                    ]"
                                >
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex items-center">
                                            <span class="text-lg font-semibold" x-text="version.version"></span>
                                            <span 
                                                x-show="version.installed" 
                                                class="ml-2 px-2 py-0.5 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full"
                                            >
                                                <span data-i18n="plugins.version_modal.installed"></span>
                                            </span>
                                            <span 
                                                x-show="version.prerelease" 
                                                class="ml-2 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs rounded-full"
                                            >
                                                <span data-i18n="plugins.version_modal.prerelease"></span>
                                            </span>
                                        </div>
                                        <span class="text-sm text-gray-500 dark:text-gray-400" x-text="formatDate(version.release_date)"></span>
                                    </div>
                                    
                                    <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mt-1">
                                        <i class="fas fa-download mr-1"></i>
                                        <span x-text="formatNumber(version.download_count)"></span>
                                    </div>
                                    
                                    <div x-show="version.description" class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                        <p x-text="version.description"></p>
                                    </div>
                                    
                                    <div x-show="version.processing" class="mt-3 flex items-center text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-circle-notch fa-spin mr-2"></i>
                                        <span data-i18n="plugins.version_modal.processing"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button @click="closeVersionModal()" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none transition-colors">
                        <span data-i18n="plugins.close"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 导入主脚本 -->
<script src="js/main.js"></script>

<!-- 公告脚本 -->
<script src="js/notice.js"></script>

    <!-- 本地插件页面脚本 -->
    <script src="js/plugins.js"></script>
</body>
</html> 